{% extends "base.html" %}

{% block content %}
<div class="max-w-xl mx-auto mt-10 bg-white rounded-xl shadow p-6">
  <h2 class="text-xl font-bold mb-4">ğŸ”„ ãƒ•ã‚¡ã‚¤ãƒ«åä¸€æ‹¬å¤‰æ›ãƒ„ãƒ¼ãƒ«</h2>

  <form action="/tools/rename" method="POST" enctype="multipart/form-data" id="renameForm">
    <div class="mb-4">
      <label class="block mb-1">ãƒ•ã‚¡ã‚¤ãƒ«ã‚’è¤‡æ•°é¸æŠ:</label>
      <input type="file" name="files" multiple class="w-full" id="fileInput">
    </div>

    <div class="mb-4">
      <label class="block mb-1">å¤‰æ›æ–¹æ³•:</label>
      <select name="mode" class="w-full border rounded px-2 py-1">
        <option value="sequential">é€£ç•ªï¼ˆprefix_001.extï¼‰</option>
        <option value="date">æ—¥ä»˜ï¼‹é€£ç•ªï¼ˆ20250706_001.extï¼‰</option>
        <option value="replace">æ–‡å­—åˆ—ç½®æ›</option>
        <option value="append-sequential">å…ƒå_é€£ç•ª</option>
        <option value="append-date">å…ƒå_æ—¥ä»˜</option>
      </select>
    </div>

    <div class="mb-4" id="replace-options" style="display: none;">
      <label class="block mb-1">ç½®æ›å…ƒ:</label>
      <input type="text" name="search" class="w-full border rounded px-2 py-1">
      <label class="block mb-1 mt-2">ç½®æ›å…ˆ:</label>
      <input type="text" name="replace" class="w-full border rounded px-2 py-1">
    </div>

    <div class="mb-4">
      <label class="block mb-1">æ¥é ­èªï¼ˆprefixï¼‰:</label>
      <input type="text" name="prefix" class="w-full border rounded px-2 py-1" placeholder="ä¾‹: file_">
    </div>

    <div class="mb-4">
      <label class="block mb-1">é¸æŠä¸­ã®ãƒ•ã‚¡ã‚¤ãƒ«:</label>
      <ul id="fileList" class="list-disc pl-4 text-sm text-gray-700">
        <!-- é¸æŠã•ã‚ŒãŸãƒ•ã‚¡ã‚¤ãƒ«ãŒã“ã“ã«è¡¨ç¤ºã•ã‚Œã¾ã™ -->
      </ul>
    </div>

    <button type="submit" class="bg-blue-600 text-white px-4 py-2 rounded hover:bg-blue-700">å¤‰æ›ï¼†ãƒ€ã‚¦ãƒ³ãƒ­ãƒ¼ãƒ‰</button>
  </form>
</div>

<script>
  const fileInput = document.getElementById('fileInput');
  const fileList = document.getElementById('fileList');
  const form = document.getElementById('renameForm');
  let filesArray = [];

  // ãƒ•ã‚¡ã‚¤ãƒ«è¿½åŠ æ™‚ã®å‡¦ç†
  fileInput.addEventListener('change', function () {
    const newFiles = Array.from(fileInput.files);
    filesArray = [...filesArray, ...newFiles]; // æ—¢å­˜ã®ãƒ•ã‚¡ã‚¤ãƒ«ã¨æ–°ã—ã„ãƒ•ã‚¡ã‚¤ãƒ«ã‚’çµåˆ
    updateFileList(); // ãƒ•ã‚¡ã‚¤ãƒ«ãƒªã‚¹ãƒˆã‚’æ›´æ–°
  });

  // ãƒ•ã‚¡ã‚¤ãƒ«ãƒªã‚¹ãƒˆæ›´æ–°
  function updateFileList() {
    fileList.innerHTML = ''; // ãƒªã‚¹ãƒˆã‚’ãƒªã‚»ãƒƒãƒˆ
    filesArray.forEach((file, index) => {
      const li = document.createElement('li');
      li.textContent = file.name;
      const removeButton = document.createElement('button');
      removeButton.textContent = 'å‰Šé™¤';
      removeButton.className = 'ml-2 text-red-500';
      removeButton.onclick = function () {
        removeFile(index); // ã‚¤ãƒ³ãƒ‡ãƒƒã‚¯ã‚¹ã§ãƒ•ã‚¡ã‚¤ãƒ«ã‚’å‰Šé™¤
      };
      li.appendChild(removeButton);
      fileList.appendChild(li);
    });
  }

  // ãƒ•ã‚¡ã‚¤ãƒ«å‰Šé™¤
  function removeFile(index) {
    filesArray.splice(index, 1); // æŒ‡å®šã•ã‚ŒãŸã‚¤ãƒ³ãƒ‡ãƒƒã‚¯ã‚¹ã®ãƒ•ã‚¡ã‚¤ãƒ«ã‚’å‰Šé™¤
    updateFileList(); // ãƒªã‚¹ãƒˆã‚’æ›´æ–°
    // ãƒ•ã‚©ãƒ¼ãƒ ã®å…¥åŠ›å†…å®¹ã‚’å†è¨­å®š
    const dataTransfer = new DataTransfer();
    filesArray.forEach(file => dataTransfer.items.add(file));
    fileInput.files = dataTransfer.files;
  }

  // ãƒ•ã‚©ãƒ¼ãƒ é€ä¿¡æ™‚ã«ãƒ•ã‚¡ã‚¤ãƒ«ã‚’é€ä¿¡å¯¾è±¡ã¨ã—ã¦åæ˜ 
  form.addEventListener('submit', function(event) {
    const dataTransfer = new DataTransfer();
    filesArray.forEach(file => dataTransfer.items.add(file));
    fileInput.files = dataTransfer.files; // é€ä¿¡å¯¾è±¡ã¨ã—ã¦åæ˜ 
  });

  document.querySelector('select[name="mode"]').addEventListener('change', function () {
    document.getElementById('replace-options').style.display =
      this.value === 'replace' ? 'block' : 'none';
  });
</script>
{% endblock %}
