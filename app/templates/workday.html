{% extends "base.html" %}

{% block content %}
<div class="max-w-4xl mx-auto mt-10 bg-white rounded-xl shadow p-6">
  <h2 class="text-xl font-bold mb-4">ğŸ“… å–¶æ¥­æ—¥è¨ˆç®—ãƒ„ãƒ¼ãƒ«</h2>

  <form action="/tools/workday" method="POST" class="mb-6" id="workday-form">
    <div class="mb-4">
      <label class="block mb-1">é–‹å§‹æ—¥:</label>
      <input type="date" name="start_date" class="w-full border rounded px-2 py-1" 
             value="{{ request.form.get('start_date', '') }}" required>
    </div>

    <div class="mb-4">
      <label class="block mb-1">çµ‚äº†æ—¥:</label>
      <input type="date" name="end_date" class="w-full border rounded px-2 py-1" 
             value="{{ request.form.get('end_date', '') }}" required>
    </div>

    <div class="mb-4">
      <label class="block mb-1">å–¶æ¥­æ—¥ã¨ã™ã‚‹æ›œæ—¥:</label>
      <div class="grid grid-cols-2 gap-2 sm:flex sm:justify-between">
        {% set selected_weekdays = request.form.getlist('weekdays[]') %}
        <label class="flex items-center"><input type="checkbox" name="weekdays[]" value="0" {% if '0' in selected_weekdays %}checked{% endif %} class="mr-1"> æ—¥æ›œæ—¥</label>
        <label class="flex items-center"><input type="checkbox" name="weekdays[]" value="1" {% if '1' in selected_weekdays %}checked{% endif %} class="mr-1"> æœˆæ›œæ—¥</label>
        <label class="flex items-center"><input type="checkbox" name="weekdays[]" value="2" {% if '2' in selected_weekdays %}checked{% endif %} class="mr-1"> ç«æ›œæ—¥</label>
        <label class="flex items-center"><input type="checkbox" name="weekdays[]" value="3" {% if '3' in selected_weekdays %}checked{% endif %} class="mr-1"> æ°´æ›œæ—¥</label>
        <label class="flex items-center"><input type="checkbox" name="weekdays[]" value="4" {% if '4' in selected_weekdays %}checked{% endif %} class="mr-1"> æœ¨æ›œæ—¥</label>
        <label class="flex items-center"><input type="checkbox" name="weekdays[]" value="5" {% if '5' in selected_weekdays %}checked{% endif %} class="mr-1"> é‡‘æ›œæ—¥</label>
        <label class="flex items-center"><input type="checkbox" name="weekdays[]" value="6" {% if '6' in selected_weekdays %}checked{% endif %} class="mr-1"> åœŸæ›œæ—¥</label>
      </div>
    </div>
    
    <div class="mb-4">
      <label class="block mb-1">ç¥æ—¥ã®æ‰±ã„:</label>
      <label class="flex items-center">
        <input type="checkbox" name="count_holidays" class="mr-2" {% if request.form.get('count_holidays') == 'on' %}checked{% endif %}> 
        ç¥æ—¥ã‚’å–¶æ¥­æ—¥ã¨ã—ã¦ã‚«ã‚¦ãƒ³ãƒˆ
      </label>
    </div>

    <div class="mb-4">
      <label class="block mb-1">ç‰¹åˆ¥é™¤å¤–æ—¥:</label>
      <textarea name="holidays" rows="3" class="w-full border rounded px-2 py-1" 
                placeholder="ä¾‹: 2025-01-01,2025-05-03">{{ request.form.get('holidays', '') }}</textarea>
    </div>

    <div>
      â€»å¹´æœ«å¹´å§‹ã¯ãƒ‡ãƒ•ã‚©ãƒ«ãƒˆã§ã¯1æœˆ1æ—¥ã®ã¿ã‚’é™¤å¤–æ—¥ã¨ã—ã¦ã„ã¾ã™ã€‚<br>
    </div>

    <button type="submit" class="bg-blue-600 text-white px-4 py-2 rounded hover:bg-blue-700">å–¶æ¥­æ—¥è¨ˆç®—</button>
  </form>

  {% if calendar %}
    <div class="mt-6">
      <div class="flex justify-between items-center mb-4">
        <h3 class="font-semibold">ğŸ“… å–¶æ¥­æ—¥ã‚«ãƒ¬ãƒ³ãƒ€ãƒ¼</h3>
        <form method="POST" action="{{ url_for('workday.download_excel') }}" style="display: inline-block;">
          <!-- éš ã—ãƒ•ã‚£ãƒ¼ãƒ«ãƒ‰ã§è¨­å®šå€¤ã‚’æ¸¡ã™ -->
          <input type="hidden" name="start_date" value="{{ request.form.get('start_date') }}">
          <input type="hidden" name="end_date" value="{{ request.form.get('end_date') }}">
          {% for weekday in request.form.getlist('weekdays[]') %}
          <input type="hidden" name="weekdays[]" value="{{ weekday }}">
          {% endfor %}
          <input type="hidden" name="holidays" value="{{ request.form.get('holidays', '') }}">
          {% if request.form.get('count_holidays') == 'on' %}
          <input type="hidden" name="count_holidays" value="on">
          {% endif %}
          
          <button type="submit" class="bg-green-600 text-white px-4 py-2 rounded hover:bg-green-700 text-sm">
            ğŸ“Š ã‚¨ã‚¯ã‚»ãƒ«ã§ãƒ€ã‚¦ãƒ³ãƒ­ãƒ¼ãƒ‰
          </button>
        </form>
      </div>

      <div class="mb-4 text-sm">
        <span class="inline-block w-4 h-4 bg-green-100 border mr-2"></span>å–¶æ¥­æ—¥
        <span class="inline-block w-4 h-4 bg-gray-300 border mr-2 ml-4"></span>ä¼‘æ—¥
      </div>
      
      {% for (year, month), days in calendar.items() %}
        <h4 class="text-lg font-semibold mt-6">{{ year }}å¹´{{ month }}æœˆ</h4>
        <div class="overflow-x-auto">
          <table class="table-auto border-collapse w-full text-sm">
            <thead>
              <tr>
                <th class="px-2 py-1 border bg-gray-100 text-red-600">æ—¥</th>
                <th class="px-2 py-1 border bg-gray-100">æœˆ</th>
                <th class="px-2 py-1 border bg-gray-100">ç«</th>
                <th class="px-2 py-1 border bg-gray-100">æ°´</th>
                <th class="px-2 py-1 border bg-gray-100">æœ¨</th>
                <th class="px-2 py-1 border bg-gray-100">é‡‘</th>
                <th class="px-2 py-1 border bg-gray-100 text-blue-600">åœŸ</th>
              </tr>
            </thead>
            <tbody>
              {% for row in days %}
                <tr>
                  {% for day in row %}
                    <td class="px-2 py-1 border text-center {% if day.is_workday %}bg-green-100{% elif day.date %}bg-gray-300{% else %}bg-gray-50{% endif %}">
                      {% if day.date %}
                        {{ day.date.strftime('%d') }}
                      {% else %}
                        
                      {% endif %}
                    </td>
                  {% endfor %}
                </tr>
              {% endfor %}
            </tbody>
          </table>
        </div>
      {% endfor %}
    </div>
  {% endif %}

  {% if workday_count %}
    <div class="mt-6 p-4 bg-blue-50 rounded-lg">
      <h3 class="font-semibold mb-2">ğŸ“Š çµæœ:</h3>
      <p class="text-lg">æŒ‡å®šæœŸé–“å†…ã®å–¶æ¥­æ—¥æ•°: <span class="font-bold text-blue-600">{{ workday_count }}æ—¥</span></p>
    </div>
  {% endif %}
</div>
{% endblock %}